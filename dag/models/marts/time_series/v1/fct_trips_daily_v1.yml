version: 2

models:
  - name: fct_trips_daily_v1
    description: Daily aggregated bike share trip facts with ML features for time series forecasting
    columns:
      # Primary key
      - name: trip_date
        data_type: date
        tests:
          - not_null
          - unique

      # Date & Time features (non-leaky)
      - name: day_of_week
        data_type: bigint
      - name: day_name
        data_type: varchar
      - name: is_weekend
        data_type: boolean
      - name: month_num
        data_type: bigint
      - name: year
        data_type: bigint
      - name: day_of_month
        data_type: bigint
      - name: week_of_year
        data_type: bigint

      # Trip volume features (LEAKY - for training labels only)
      - name: total_trips__leaky
        data_type: bigint
      - name: annual_member_trips__leaky
        data_type: bigint
      - name: casual_member_trips__leaky
        data_type: bigint
      - name: annual_member_ratio__leaky
        data_type: double
      - name: unique_bikes__leaky
        data_type: bigint
      - name: unique_start_stations__leaky
        data_type: bigint
      - name: unique_end_stations__leaky
        data_type: bigint

      # Trip duration features (LEAKY - for training labels only)
      - name: avg_trip_duration__leaky
        data_type: double
      - name: median_trip_duration__leaky
        data_type: bigint
      - name: min_trip_duration__leaky
        data_type: bigint
      - name: max_trip_duration__leaky
        data_type: bigint
      - name: stddev_trip_duration__leaky
        data_type: double
      - name: p25_trip_duration__leaky
        data_type: double
      - name: p75_trip_duration__leaky
        data_type: double
      - name: avg_annual_member_duration__leaky
        data_type: double
      - name: avg_casual_member_duration__leaky
        data_type: double

      # Weather features (non-leaky)
      - name: max_temp_c
        data_type: double
      - name: min_temp_c
        data_type: double
      - name: mean_temp_c
        data_type: double
      - name: temp_range_c
        data_type: double
      - name: total_precip_mm
        data_type: double
      - name: snow_on_grnd_cm
        data_type: bigint

      # Station activity features (LEAKY - for training labels only)
      - name: top_start_station_id__leaky
        data_type: bigint
      - name: top_start_station_trips__leaky
        data_type: bigint
      - name: top_end_station_id__leaky
        data_type: varchar
      - name: top_end_station_trips__leaky
        data_type: bigint

      # Trip volume lags (non-leaky)
      - name: trips_lag_1d
        data_type: bigint
      - name: trips_lag_2d
        data_type: bigint
      - name: trips_lag_3d
        data_type: bigint
      - name: trips_lag_7d
        data_type: bigint
      - name: trips_lag_14d
        data_type: bigint
      - name: trips_lag_30d
        data_type: bigint

      # Trip volume rolling statistics (non-leaky)
      - name: trips_rolling_7d_avg
        data_type: double
      - name: trips_rolling_7d_std
        data_type: double
      - name: trips_rolling_7d_min
        data_type: bigint
      - name: trips_rolling_7d_max
        data_type: bigint
      - name: trips_rolling_7d_median
        data_type: bigint
      - name: trips_rolling_30d_avg
        data_type: double
      - name: trips_rolling_30d_std
        data_type: double
      - name: trips_rolling_30d_min
        data_type: bigint
      - name: trips_rolling_30d_max
        data_type: bigint
      - name: trips_rolling_30d_median
        data_type: bigint

      # User mix lags (non-leaky)
      - name: annual_member_ratio_lag_1d
        data_type: double
      - name: annual_member_ratio_lag_7d
        data_type: double
      - name: annual_member_ratio_rolling_7d_avg
        data_type: double
      - name: annual_member_trips_lag_7d
        data_type: bigint
      - name: casual_member_trips_lag_7d
        data_type: bigint

      # Duration lags (non-leaky)
      - name: avg_trip_duration_lag_1d
        data_type: double
      - name: avg_trip_duration_lag_7d
        data_type: double
      - name: avg_trip_duration_rolling_7d_avg
        data_type: double
      - name: avg_trip_duration_rolling_30d_avg
        data_type: double

      # Network activity lags (non-leaky)
      - name: unique_bikes_lag_1d
        data_type: bigint
      - name: unique_bikes_lag_7d
        data_type: bigint
      - name: unique_start_stations_lag_1d
        data_type: bigint
      - name: unique_start_stations_lag_7d
        data_type: bigint
      - name: unique_start_stations_rolling_30d_avg
        data_type: double

      # Change indicators (non-leaky)
      - name: trips_change_1d_vs_2d_pct
        data_type: double
      - name: trips_change_7d_vs_14d_pct
        data_type: double
