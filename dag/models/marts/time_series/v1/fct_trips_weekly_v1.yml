version: 2

models:
  - name: fct_trips_weekly_v1
    description: Weekly aggregated bike share trip facts with ML features for time series forecasting
    columns:
      # Primary key
      - name: week_start_date
        data_type: timestamp
        tests:
          - not_null
          - unique

      # Time features (non-leaky)
      - name: year
        data_type: bigint
      - name: week_of_year
        data_type: bigint
      - name: month_num
        data_type: bigint
      - name: days_in_week
        data_type: bigint

      # Trip volume features (LEAKY - for training labels only)
      - name: total_trips__leaky
        data_type: bigint
      - name: avg_daily_trips__leaky
        data_type: double
      - name: annual_member_trips__leaky
        data_type: bigint
      - name: casual_member_trips__leaky
        data_type: bigint
      - name: annual_member_ratio__leaky
        data_type: double
      - name: unique_bikes__leaky
        data_type: double
      - name: unique_start_stations__leaky
        data_type: double
      - name: unique_end_stations__leaky
        data_type: double

      # Trip duration features (LEAKY - for training labels only)
      - name: avg_trip_duration__leaky
        data_type: double
      - name: median_trip_duration__leaky
        data_type: double
      - name: min_trip_duration__leaky
        data_type: bigint
      - name: max_trip_duration__leaky
        data_type: bigint

      # Weather features (non-leaky)
      - name: avg_max_temp_c
        data_type: double
      - name: avg_min_temp_c
        data_type: double
      - name: avg_mean_temp_c
        data_type: double
      - name: max_temp_c
        data_type: double
      - name: min_temp_c
        data_type: double

      # Trip volume lags (non-leaky)
      - name: trips_lag_1w
        data_type: bigint
      - name: trips_lag_4w
        data_type: bigint
      - name: trips_lag_12w
        data_type: bigint
      - name: trips_lag_52w
        data_type: bigint
      - name: trips_rolling_4w_avg
        data_type: double
      - name: trips_rolling_12w_avg
        data_type: double
      - name: trips_rolling_52w_avg
        data_type: double

      # Change indicators (non-leaky)
      - name: trips_change_1w_pct
        data_type: double
      - name: trips_change_52w_pct
        data_type: double

      # User mix lags (non-leaky)
      - name: annual_member_ratio_lag_1w
        data_type: double
      - name: annual_member_ratio_rolling_4w_avg
        data_type: double

      # Duration lags (non-leaky)
      - name: avg_trip_duration_lag_1w
        data_type: double
      - name: avg_trip_duration_rolling_4w_avg
        data_type: double
