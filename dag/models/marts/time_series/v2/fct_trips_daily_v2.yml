version: 2

models:
  - name: fct_trips_daily_v2
    description: Simplified daily bike share trip facts - v2 minimal feature set for ML. Contains daily aggregated trip metrics with temporal features, weather data, and lagged variables for time series forecasting.
    columns:
      # Primary key
      - name: trip_date
        description: Date of the bike trips (primary key)
        data_type: date
        tests:
          - not_null
          - unique

      # Date & Time features (non-leaky)
      - name: day_of_week
        description: Day of week as integer (1=Monday, 7=Sunday)
        data_type: bigint
        tests:
          - not_null
      - name: day_name
        description: Name of the day (Monday, Tuesday, etc.)
        data_type: varchar
        tests:
          - not_null
      - name: is_weekend
        description: Boolean flag indicating if the day is a weekend (Saturday or Sunday)
        data_type: boolean
        tests:
          - not_null
      - name: is_holiday
        description: Boolean flag indicating if the day is a Canadian statutory holiday (joined from seed_holidays on date)
        data_type: boolean
        tests:
          - not_null
      - name: has_covid_restrictions
        description: Boolean flag indicating if COVID-19 restrictions were in place during this month (joined from seed_covid_timeline on year/month, defaults to false for dates after Sept 2022)
        data_type: boolean
        tests:
          - not_null
      - name: month_num
        description: Month number (1-12)
        data_type: bigint
        tests:
          - not_null
      - name: year
        description: Calendar year
        data_type: bigint
        tests:
          - not_null
      - name: day_of_month
        description: Day of the month (1-31)
        data_type: bigint
        tests:
          - not_null
      - name: week_of_year
        description: ISO week number of the year (1-53)
        data_type: bigint
        tests:
          - not_null

      # Target variables (LEAKY - what we're predicting)
      - name: total_trips__leaky
        description: Total number of bike trips on this day (TARGET VARIABLE - leaky, should not be used as a feature for prediction)
        data_type: bigint
        tests:
          - not_null
      - name: avg_trip_duration__leaky
        description: Average trip duration in seconds for this day (TARGET VARIABLE - leaky, should not be used as a feature for prediction)
        data_type: double
        tests:
          - not_null

      # Weather features (non-leaky)
      - name: mean_temp_c
        description: Mean temperature in Celsius for the day (from weather station data)
        data_type: double
        tests:
          - not_null
      - name: total_precip_mm
        description: Total precipitation in millimeters for the day (from weather station data)
        data_type: double
        tests:
          - not_null

      # Trip volume features (non-leaky - predictive)
      - name: trips_lag_7d
        description: Total trips from 7 days ago (lag feature for time series forecasting)
        data_type: bigint
      - name: trips_rolling_7d_avg
        description: Rolling 7-day average of total trips (excludes current day, uses 7 preceding days only)
        data_type: double

      # User mix features (non-leaky - predictive)
      - name: annual_member_ratio_lag_7d
        description: Ratio of annual members to total riders from 7 days ago (lag feature indicating user composition)
        data_type: double
