version: 2

models:
  - name: int_combined_trip_weekly
    columns:
      # Primary key
      - name: week_start_date
        data_type: timestamp
        tests:
          - not_null

      # Time features (non-leaky)
      - name: year
        data_type: bigint
        tests:
          - not_null
      - name: week_of_year
        data_type: bigint
        tests:
          - not_null
      - name: month_num
        data_type: bigint
        tests:
          - not_null
      - name: days_in_week
        data_type: bigint
        tests:
          - not_null

      # Trip volume features (LEAKY - for training labels only)
      - name: total_trips__leaky
        data_type: bigint
        tests:
          - not_null
      - name: avg_daily_trips__leaky
        data_type: double
        tests:
          - not_null
      - name: annual_member_trips__leaky
        data_type: bigint
        tests:
          - not_null
      - name: casual_member_trips__leaky
        data_type: bigint
        tests:
          - not_null
      - name: annual_member_ratio__leaky
        data_type: double
        tests:
          - not_null
      - name: unique_bikes__leaky
        data_type: double
        tests:
          - not_null
      - name: unique_start_stations__leaky
        data_type: double
        tests:
          - not_null
      - name: unique_end_stations__leaky
        data_type: double
        tests:
          - not_null

      # Trip duration features (LEAKY - for training labels only)
      - name: avg_trip_duration__leaky
        data_type: double
        tests:
          - not_null
      - name: median_trip_duration__leaky
        data_type: double
        tests:
          - not_null
      - name: min_trip_duration__leaky
        data_type: bigint
        tests:
          - not_null
      - name: max_trip_duration__leaky
        data_type: bigint
        tests:
          - not_null

      # Weather features (non-leaky)
      - name: avg_max_temp_c
        data_type: double
        tests:
          - not_null
      - name: avg_min_temp_c
        data_type: double
        tests:
          - not_null
      - name: avg_mean_temp_c
        data_type: double
        tests:
          - not_null
      - name: max_temp_c
        data_type: double
        tests:
          - not_null
      - name: min_temp_c
        data_type: double
        tests:
          - not_null
      - name: avg_total_precip_mm
        data_type: double
        tests:
          - not_null
      - name: avg_snow_on_grnd_cm
        data_type: double
        tests:
          - not_null
      - name: max_total_precip_mm
        data_type: double
        tests:
          - not_null
      - name: max_snow_on_grnd_cm
        data_type: double
        tests:
          - not_null
      - name: min_total_precip_mm
        data_type: double
        tests:
          - not_null
      - name: min_snow_on_grnd_cm
        data_type: double
        tests:
          - not_null

      # Trip volume lags (non-leaky)
      - name: trips_lag_1w
        data_type: bigint
      - name: trips_lag_2w
        data_type: bigint
      - name: trips_lag_4w
        data_type: bigint
      - name: trips_lag_12w
        data_type: bigint
      - name: trips_lag_52w
        data_type: bigint

      # Trip volume rolling statistics - 4 week (non-leaky)
      - name: trips_rolling_4w_avg
        data_type: double
      - name: trips_rolling_4w_std
        data_type: double
      - name: trips_rolling_4w_min
        data_type: bigint
      - name: trips_rolling_4w_max
        data_type: bigint
      - name: trips_rolling_4w_median
        data_type: bigint

      # Trip volume rolling statistics - 12 week (non-leaky)
      - name: trips_rolling_12w_avg
        data_type: double
      - name: trips_rolling_12w_std
        data_type: double
      - name: trips_rolling_12w_min
        data_type: bigint
      - name: trips_rolling_12w_max
        data_type: bigint
      - name: trips_rolling_12w_median
        data_type: bigint

      # Trip volume rolling statistics - 52 week (non-leaky)
      - name: trips_rolling_52w_avg
        data_type: double
      - name: trips_rolling_52w_std
        data_type: double
      - name: trips_rolling_52w_min
        data_type: bigint
      - name: trips_rolling_52w_max
        data_type: bigint
      - name: trips_rolling_52w_median
        data_type: bigint

      # Change indicators (non-leaky - comparing historical periods only)
      - name: trips_change_1w_vs_2w_pct
        data_type: double
      - name: trips_change_52w_vs_104w_pct
        data_type: double

      # User mix lags (non-leaky)
      - name: annual_member_ratio_lag_1w
        data_type: double
      - name: annual_member_ratio_rolling_4w_avg
        data_type: double

      # Duration lags (non-leaky)
      - name: avg_trip_duration_lag_1w
        data_type: double
      - name: avg_trip_duration_rolling_4w_avg
        data_type: double
