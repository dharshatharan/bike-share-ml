version: 2

models:
  - name: int_combined_trip_monthly
    columns:
      # Primary key
      - name: month_start_date
        data_type: timestamp
        tests:
          - not_null

      # Time features (non-leaky)
      - name: year
        data_type: bigint
        tests:
          - not_null
      - name: month_num
        data_type: bigint
        tests:
          - not_null
      - name: month_name
        data_type: varchar
        tests:
          - not_null
      - name: quarter
        data_type: bigint
        tests:
          - not_null
      - name: days_in_month
        data_type: bigint
        tests:
          - not_null

      # Holiday and event features (non-leaky)
      - name: non_working_day_ratio
        data_type: double
        tests:
          - not_null
      - name: has_covid_restrictions
        data_type: boolean
        tests:
          - not_null

      # Trip volume features (LEAKY - for training labels only)
      - name: total_trips__leaky
        data_type: bigint
        tests:
          - not_null
      - name: avg_daily_trips__leaky
        data_type: double
        tests:
          - not_null
      - name: annual_member_trips__leaky
        data_type: bigint
        tests:
          - not_null
      - name: casual_member_trips__leaky
        data_type: bigint
        tests:
          - not_null
      - name: annual_member_ratio__leaky
        data_type: double
        tests:
          - not_null
      - name: unique_bikes__leaky
        data_type: double
        tests:
          - not_null
      - name: unique_start_stations__leaky
        data_type: double
        tests:
          - not_null
      - name: unique_end_stations__leaky
        data_type: double
        tests:
          - not_null

      # Trip duration features (LEAKY - for training labels only)
      - name: avg_trip_duration__leaky
        data_type: double
        tests:
          - not_null
      - name: median_trip_duration__leaky
        data_type: double
        tests:
          - not_null
      - name: min_trip_duration__leaky
        data_type: bigint
        tests:
          - not_null
      - name: max_trip_duration__leaky
        data_type: bigint
        tests:
          - not_null

      # Weather features (non-leaky)
      - name: avg_max_temp_c
        data_type: double
        tests:
          - not_null
      - name: avg_min_temp_c
        data_type: double
        tests:
          - not_null
      - name: avg_mean_temp_c
        data_type: double
        tests:
          - not_null
      - name: max_temp_c
        data_type: double
        tests:
          - not_null
      - name: min_temp_c
        data_type: double
        tests:
          - not_null
      - name: avg_total_precip_mm
        data_type: double
        tests:
          - not_null
      - name: avg_snow_on_grnd_cm
        data_type: double
        tests:
          - not_null
      - name: max_total_precip_mm
        data_type: double
        tests:
          - not_null
      - name: max_snow_on_grnd_cm
        data_type: double
        tests:
          - not_null
      - name: min_total_precip_mm
        data_type: double
        tests:
          - not_null
      - name: min_snow_on_grnd_cm
        data_type: double
        tests:
          - not_null

      # Trip volume lags (non-leaky)
      - name: trips_lag_1m
        data_type: bigint
      - name: trips_lag_2m
        data_type: bigint
      - name: trips_lag_3m
        data_type: bigint
      - name: trips_lag_6m
        data_type: bigint
      - name: trips_lag_12m
        data_type: bigint

      # Trip volume rolling statistics - 3 month (non-leaky)
      - name: trips_rolling_3m_avg
        data_type: double
      - name: trips_rolling_3m_std
        data_type: double
      - name: trips_rolling_3m_min
        data_type: bigint
      - name: trips_rolling_3m_max
        data_type: bigint
      - name: trips_rolling_3m_median
        data_type: bigint

      # Trip volume rolling statistics - 6 month (non-leaky)
      - name: trips_rolling_6m_avg
        data_type: double
      - name: trips_rolling_6m_std
        data_type: double
      - name: trips_rolling_6m_min
        data_type: bigint
      - name: trips_rolling_6m_max
        data_type: bigint
      - name: trips_rolling_6m_median
        data_type: bigint

      # Trip volume rolling statistics - 12 month (non-leaky)
      - name: trips_rolling_12m_avg
        data_type: double
      - name: trips_rolling_12m_std
        data_type: double
      - name: trips_rolling_12m_min
        data_type: bigint
      - name: trips_rolling_12m_max
        data_type: bigint
      - name: trips_rolling_12m_median
        data_type: bigint

      # Change indicators (non-leaky - comparing historical periods only)
      - name: trips_change_1m_vs_2m_pct
        data_type: double
      - name: trips_change_12m_vs_24m_pct
        data_type: double

      # User mix lags (non-leaky)
      - name: annual_member_ratio_lag_1m
        data_type: double
      - name: annual_member_ratio_rolling_3m_avg
        data_type: double

      # Duration lags (non-leaky)
      - name: avg_trip_duration_lag_1m
        data_type: double
      - name: avg_trip_duration_rolling_3m_avg
        data_type: double
